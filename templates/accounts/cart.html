{% extends 'base.html' %} {% load static %} {% block content %}
<!-- Page content -->
<div class="page-content">
  <!-- Page title -->
  <div class="page-title">
    <div class="row justify-content-between align-items-center">
      <div
        class="col-md-6 d-flex align-items-center justify-content-between justify-content-md-start mb-3 mb-md-0"
      >
        <!-- Page title + Go Back button -->
        <div class="d-inline-block">
          <h5 class="h4 d-inline-block font-weight-400 mb-0 text-white">
            Billing
          </h5>
        </div>
        <!-- Additional info -->
      </div>
      <div
        class="col-md-6 d-flex align-items-center justify-content-between justify-content-md-end"
      ></div>
    </div>
  </div>
  <!-- Nav -->
  <ul class="nav nav-dark nav-tabs nav-overflow">
    <li class="nav-item">
      <a href="billing.html" class="nav-link active">
        <i class="fas fa-credit-card mr-2"></i>Cards Details
      </a>
    </li>
    {% comment %}
    <li class="nav-item">
      <a href="payment-history.html" class="nav-link">
        <i class="fas fa-file-invoice mr-2"></i>History
      </a>
    </li>
    {% endcomment %}
  </ul>
  <div class="row">
    <div class="col-lg-4 order-lg-2">
      <div class="card">
        <div class="list-group list-group-flush">
          <div class="list-group-item">
            <div class="media">
              <i class="fas fa-user"></i>
              <div class="media-body ml-3">
                <a href="#" class="stretched-link h6 mb-1">Settings</a>
                <p class="mb-0 text-sm">
                  Details about your personal information
                </p>
              </div>
            </div>
          </div>
          <div class="list-group-item">
            <div class="media">
              <i class="fas fa-map-marker-alt"></i>
              <div class="media-body ml-3">
                <a href="{% url 'change_card' %}" class="stretched-link h6 mb-1">Change Card</a>
                <p class="mb-0 text-sm">Faster checkout and change card</p>
              </div>
            </div>
          </div>
          <div class="list-group-item active">
            <div class="media">
              <i class="fas fa-credit-card"></i>
              <div class="media-body ml-3">
                <a href="#" class="stretched-link h6 mb-1">Billing</a>
                <p class="mb-0 text-sm">Speed up your shopping experience</p>
              </div>
            </div>
          </div>
          <div class="list-group-item">
            <div class="media">
              <i class="fas fa-file-invoice"></i>
              <div class="media-body ml-3">
                <a
                  href="{% url 'account_history' %}"
                  class="stretched-link h6 mb-1"
                  >Payment history</a
                >
                <p class="mb-0 text-sm">See previous orders and invoices</p>
              </div>
            </div>
          </div>
          <div class="list-group-item">
            <div class="media">
              <i class="fas fa-bell"></i>
              <div class="media-body ml-3">
                <a href="#" class="stretched-link h6 mb-1">Notifications</a>
                <p class="mb-0 text-sm">
                  Choose what notification you will receive
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-8 order-lg-1">
      <div class="card">
        <div class="card-header">
          <span class="h6">Summary</span>
        </div>
        <div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <div class="row align-items-center">
                <div class="col-sm-4">
                  <small class="h6 text-sm mb-3 mb-sm-0">Plan</small>
                </div>
                <div class="col-sm-5">
                  <strong>Free</strong>Cancel plan, unlimited public
                  repositories.
                </div>
                <div class="col-sm-3 text-sm-right">
                  <a
                    href="#"
                    class="btn btn-sm btn-primary rounded-pill mt-3 mt-sm-0"
                    >Cancel</a
                  >
                </div>
              </div>
            </li>
            {% comment %}
            <li class="list-group-item">
              <div class="row">
                <div class="col-sm-4">
                  <small class="h6 text-sm mb-3 mb-sm-0"
                    >Credit or debit cards</small
                  >
                </div>
                <div class="col-sm-8">
                  <!-- First card -->
                  <div class="row mb-3">
                    <div class="col-9">
                      <img
                        alt="Image placeholder"
                        src="../../assets/img/icons/cards/visa.png"
                        class="mr-1"
                        width="30"
                      />
                      x-1023 (Expires on 11/2018)
                    </div>
                    <div class="col-3 actions text-right">
                      <a
                        href="#"
                        class="action-item"
                        data-toggle="tooltip"
                        data-original-title="Remove card"
                      >
                        <i class="fas fa-trash-alt"></i>
                      </a>
                    </div>
                  </div>
                  <!-- Second card -->
                  <div class="row">
                    <div class="col-9">
                      <img
                        alt="Image placeholder"
                        src="../../assets/img/icons/cards/skrill.png"
                        class="mr-1"
                        width="30"
                      />
                      x-3165 (Expires on 09/2017)
                    </div>
                    <div class="col-3 actions text-right">
                      <a
                        href="#"
                        class="action-item"
                        data-toggle="tooltip"
                        data-original-title="Remove card"
                      >
                        <i class="fas fa-trash-alt"></i>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="list-group-item">
              <div class="row">
                <div class="col-sm-4">
                  <small class="h6 text-sm mb-3 mb-sm-0"
                    >Other information</small
                  >
                </div>
                <div class="col-sm-8">
                  <strong>$27.00 <small>U.S Dollar</small></strong>
                </div>
              </div>
            </li>
            {% endcomment %}
            <li class="list-group-item">
              <div class="row">
                <div class="col-sm-4">
                  <small class="h6 text-sm mb-3 mb-sm-0">Your balance</small>
                </div>
                <div class="col-sm-8">
                  <p class="mb-0">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed
                    do eiusmod tempor incididunt ut labore.
                  </p>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <!-- Attach a new card -->
      <div class="card">
        <div class="card-header">
          <div class="row">
            <div class="col-5 col-lg-8">
              <span class="h6">Pay with card</span>
              <p class="text-muted text-sm mt-2 mb-0 d-none d-lg-block">
                Safe money transfer using your bank account. We support
                Mastercard, Visa, Maestro and Skrill.
              </p>
            </div>
            <div class="col-7 col-lg-4 text-right">
              <img
                alt="Image placeholder"
                src="{% static 'img/icons/cards/mastercard.png' %}"
                width="40"
                class="mr-2"
              />
              <img
                alt="Image placeholder"
                src="{% static 'img/icons/cards/visa.png' %}"
                width="40"
                class="mr-2"
              />
              <img
                alt="Image placeholder"
                src="{% static 'img/icons/cards/skrill.png' %}"
                width="40"
              />
            </div>
          </div>
        </div>
        <div class="card-body">
          <!-- form .....................form...........form......................... -->
          <form method="post" action="#" id="payment-form">
            {% csrf_token %}
            <select
              class="custom-select custom-select-sm"
              id="membership"
              name="membership"
            >
              <option selected>Membership Type</option>
              <option value="MONTHLY">MONTHLY - 3$</option>
              <option value="YEARLY">YEARLY - 30$</option>
            </select>
            <br />
            <br />
            <div class="row mt-3">
              <div class="col-md-12">
                <div class="form-group">
                  <div class="form-check">
                    <label class="form-check-label">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        name="automatic"
                        id="automatic"
                        checked
                      />
                      Auto Renewal
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="payment_method_type"
                value="card"
                id="flexRadioDefault1"
              />
              <label class="form-check-label" for="flexRadioDefault1">
                Card
              </label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="payment_method_type"
                value="paypal"
                id="flexRadioDefault2"
                checked
              />
              <label class="form-check-label" for="flexRadioDefault2">
                Paypal
              </label>
            </div>
            <div id="paypal-button-container"></div>

            <!-- <div class="row mt-3">
                    <div class="col-md-12">
                      <div class="form-group">
                        <label class="form-control-label">Card number</label>
                        <div class="input-group input-group-merge" id="card-element">
                          <input type="text" class="form-control" data-mask="0000 0000 0000 0000" placeholder="4789 5697 0541 7546">
                          <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-credit-card"></i></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                        <label class="form-control-label">Name on card</label>
                        <input type="text" class="form-control" placeholder="John Doe">
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-group">
                        <label class="form-control-label">Expiry date</label>
                        <input type="text" class="form-control" data-mask="00/00" placeholder="MM/YY">
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-group">
                        <label class="form-control-label">CVV code</label>
                        <div class="input-group input-group-merge">
                          <input type="text" class="form-control" data-mask="000" placeholder="746">
                          <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-question-circle"></i></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div> -->
            <div class="text-right">
              <button
                type="submit"
                class="btn btn-sm btn-primary rounded-pill"
                id="paynowbtn"
              >
                Proceed to payment
              </button>
            </div>
          </form>
        </div>
      </div>
      <!-- Add money using PayPal -->
      <!-- <div class="card">
              <div class="card-header">
                <div class="row">
                  <div class="col-5 col-lg-8">
                    <span class="h6">Pay with PayPal</span>
                    <p class="text-sm text-muted mt-2 mb-0 d-none d-lg-block">Pay your order using the most known and secure platform for online money transfers. You will be redirected to PayPal to finish complete your purchase.</p>
                  </div>
                  <div class="col-7 col-lg-4 text-right">
                    <img alt="Image placeholder" src="{% static 'img/icons/cards/paypal-256x160.png' %}" width="40">
                  </div>
                </div>
              </div>
              <div class="card-body">
                <form>
                  <div class="btn-group btn-group-toggle d-flex" data-toggle="buttons">
                    <label class="btn btn-sm btn-secondary flex-fill">
                      <input type="radio" name="options" id="checkboxButton3"> $10
                    </label>
                    <label class="btn btn-sm btn-secondary flex-fill">
                      <input type="radio" name="options" id="checkboxButton4"> $25
                    </label>
                    <label class="btn btn-sm btn-secondary flex-fill">
                      <input type="radio" name="options" id="checkboxButton5"> $50
                    </label>
                    <label class="btn btn-sm btn-secondary flex-fill">
                      <input type="radio" name="options" id="checkboxButton6"> $100
                    </label>
                  </div>
                  <div class="text-right mt-3">
                    <a href="#" class="btn btn-sm btn-primary rounded-pill">Pay with PayPal</a>
                  </div>
                </form>
              </div>
            </div> -->
    </div>
  </div>
</div>

{% endblock %}

<!-- Client side paypal integration  -->

{% block js%}
<!-- stripe payment is here -->
<script type="text/javascript">
  var stripe = Stripe(
    "pk_test_51IbOA2JIiVT83Jh6ysEqtiZFGfsuXyW57SdjMY29Kx3IsGGAufrS6RWJrt649UnU8JynzBWU2JupH1tDXyDraC9w00L64ItRSS"
  );

  /*
  stripe.redirectToCheckout({
  lineItems: [{
    price: 'price_1IddeXJIiVT83Jh6ZjYwkt9R',
    // Replace with the ID of your price
    quantity: 1,
  }],
  mode: 'subscription',
  successUrl: 'http://0.0.0.0:8000/accounts/payment-success?session_id={CHECKOUT_SESSION_ID}',
  cancelUrl: 'http://0.0.0.0:8000/accounts/cancel',
}).then(function (result) {
  // If `redirectToCheckout` fails due to a browser or network
  // error, display the localized error message to your customer
  // using `result.error.message`.
  alert('payment not successful')
});

*/

  $("#paynowbtn").on("click", function (event) {
    event.preventDefault();
    $("#paynowbtn").text("loading....");
    var pkg = $("#membership").val();

    if (pkg == "MONTHLY") {
      document.cookie = "package=MONTHLY;path=/";
      stripe
        .redirectToCheckout({
          lineItems: [
            {
              price: "price_1IddeXJIiVT83Jh6ZjYwkt9R",
              // Replace with the ID of your price
              quantity: 1,
            },
          ],
          mode: "subscription",
          successUrl:
            "http://127.0.0.1:8000/accounts/payment-success?session_id={CHECKOUT_SESSION_ID}",
          cancelUrl: "http://127.0.0.1:8000/accounts/cancel",
        })
        .then(function (result) {
          // If `redirectToCheckout` fails due to a browser or network
          // error, display the localized error message to your customer
          // using `result.error.message`.
          alert("payment not successful");
        });
    } else if (pkg == "YEARLY") {
      /*yearly product added here */
      document.cookie = "package=YEARLY;path=/";
      stripe
        .redirectToCheckout({
          lineItems: [
            {
              price: "price_1IddeXJIiVT83Jh6H65xxWLG",
              // Replace with the ID of your price
              quantity: 1,
            },
          ],
          mode: "subscription",
          successUrl:
            "http://127.0.0.1:8000/accounts/payment-success?session_id={CHECKOUT_SESSION_ID}",
          cancelUrl: "http://127.0.0.1:8000/accounts/cancel",
        })
        .then(function (result) {
          // If `redirectToCheckout` fails due to a browser or network
          // error, display the localized error message to your customer
          // using `result.error.message`.
          alert("payment not successful");
        });
    }
  });
</script>

<!-- end of stripe payment -->
<!--controling payment option view -->

<!-- end of payment option view -->

<!-- session for paypal dynamic price selection -->

<script type="text/javascript">
  var priceofpkg = "";
  var pkgs = "";
  $("#membership").change(function () {
    pkgs = $("#membership").val();
    document.cookie = "package=" + pkgs + ";path=/";

    if ($("#membership").val() == "MONTHLY") {
      priceofpkg = 3.0;
    } else if ($("#membership").val() == "YEARLY") {
      priceofpkg = 30.0;
    }
  });
</script>

<!-- paypal payment setup starts here -->

<!-- Replace client-id with your own client id -->

<div id="smart-button-container">
  <div style="text-align: center">
    <div id="ppaypal-button-container"></div>
  </div>
</div>
<script
  src="https://www.paypal.com/sdk/js?client-id=AX4L_tloDsGS5JvYHCnmBBWaD-br7rB_DspDI7bK5rai3ryIsPi6yxZ0kRng9Zm3Xr43ag9zmfwq5d9R&currency=USD"
  data-sdk-integration-source="button-factory"
></script>
<script>
  function initPayPalButton() {
    paypal
      .Buttons({
        style: {
          shape: "pill",
          color: "blue",
          layout: "vertical",
          label: "paypal",
        },

        createOrder: function (data, actions) {
          return actions.order.create({
            purchase_units: [
              {
                description: "food order",
                amount: { currency_code: "USD", value: priceofpkg },
              },
            ],
          });
        },

        onApprove: function (data, actions) {
          return actions.order.capture().then(function (details) {
            if (details.status == "COMPLETED") {
              window.location.href =
                "/accounts/paypal-payment-success/?paymentid=" + details.id;
            }
          });
        },

        onError: function (err) {
          console.log(err);
        },
      })
      .render("#paypal-button-container");
  }
  initPayPalButton();
</script>

<!-- paypal payment setup ends here -->

<script type="text/javascript">
  $("#paynowbtn").hide();

  $("input[type=radio][name=payment_method_type]").change(function () {
    if (this.value == "paypal") {
      $("#paynowbtn").hide();
      $("#paypal-button-container").show();
    } else if (this.value == "card") {
      $("#paypal-button-container").hide();
      $("#paynowbtn").show();
    }
  });

  //$('#paypal-button-container').hide();
</script>
{% endblock %}

<!-- {% block custom_script %}
  <script type="text/javascript">
    // Create an instance of the Stripe object with your publishable API key
    var stripe = Stripe("sk_test_51IbOA2JIiVT83Jh6jFfGGiIHVCqJtO6NHO0bTO4Ca0YsILC0znv1dZVL0pQUCOpiQE0J6LrA8xNfn55G2YTNPYJi00rVVcHrZU");
    var checkoutButton = document.getElementById("checkout-button");

    checkoutButton.addEventListener("click", function () {
      fetch("/create-checkout-session", {
        method: "POST",
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (session) {
          return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(function (result) {
          // If redirectToCheckout fails due to a browser or network
          // error, you should display the localized error message to your
          // customer using error.message.
          if (result.error) {
            alert(result.error.message);
          }
        })
        .catch(function (error) {
          console.error("Error:", error);
        });
    });
  </script>
 {% endblock custom_script %} -->
